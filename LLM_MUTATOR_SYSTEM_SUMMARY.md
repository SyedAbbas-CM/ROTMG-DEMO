# LLM Mutator System - Complete Summary\n\n## Overview\nThe LLM Mutator System provides **ultra-flexible building blocks** that allow AI to create incredibly complex boss behaviors by combining simple, stateful actions. Each mutator is designed to be **easily composable** and **highly configurable**.\n\n## Core Architecture Files\n\n### 1. `/src/LLMBossController.js`\n**Main coordinator between boss system and LLM**\n- Manages snapshot hashing to detect state changes\n- Coordinates with remote LLM planners (Gemini/Ollama)\n- Handles action queue processing\n- Includes safety validation via DifficultyCritic\n- Implements intelligent cooldowns and backoff\n\n### 2. `/src/mutators/index.js` \n**Central mutator registry and execution engine**\n- Houses all 18 available mutators\n- Provides execution framework with OpenTelemetry tracing\n- Manages per-action state and error handling\n- Categorizes mutators by type (basic, advanced, combat, etc.)\n\n## Complete Mutator Library (18 Total)\n\n### Basic Mutators (7)\n1. **`dash`** - Linear movement with direction and duration\n2. **`radial_burst`** - Circular projectile spread\n3. **`wait`** - Timing and pacing control\n4. **`spawn_minions`** - Basic enemy spawning in ring formation\n5. **`cone_aoe`** - Directional area damage\n6. **`reposition`** - Simple position changes\n7. **`taunt`** - Player messaging and audio cues\n\n### Advanced Formation & Positioning (3)\n8. **`spawn_formation`** - Tactical enemy formations\n   - Supports: circle, line, wedge, diamond, star, random patterns\n   - Configurable spacing, radius, enemy types\n   \n9. **`teleport_to_player`** - Smart teleportation system\n   - Target selection: random, nearest, farthest, highest_dps\n   - Offset positioning and visual effects\n   \n10. **`dynamic_movement`** - Ultra-flexible movement patterns\n    - **12 movement patterns**: circle, figure8, spiral, zigzag, sine_wave, square, triangle, star, random_walk, pulse, orbit_player, linear\n    - **Pattern chaining**: Combine multiple movements in sequence\n    - **Easing functions**: linear, ease_in, ease_out, ease_in_out, bounce, elastic\n    - **Looping and reversing**: Infinite loops with direction control\n    - **Smooth interpolation**: Physics-based movement with speed limits\n\n### Combat Abilities (3)\n11. **`charge_attack`** - Devastating charge with damage trail\n    - Predictive targeting and collision damage\n    - Visual effects and impact zones\n    \n12. **`pattern_shoot`** - Advanced projectile patterns\n    - **8 shooting patterns**: radial, shotgun, spiral, cross, star, wave, random, targeted\n    - **Advanced features**: tracking, spiral rotation, burst fire, bouncing, homing, penetrating, explosive, chain lightning\n    - **Multi-wave support**: Timed wave sequences with delays\n    \n13. **`summon_orbitals`** - Rotating projectile barriers\n    - Configurable count, radius, speed, damage\n    - Continuous orbital maintenance with visual trails\n\n### Status & Effects (2)\n14. **`heal_self`** - Boss healing system\n    - Instant or over-time healing\n    - Visual and audio feedback\n    \n15. **`shield_phase`** - Invulnerability periods\n    - Configurable duration and visual effects\n    - Pulsing indicators and color customization\n\n16. **`effect_aura`** - Dynamic status effect application\n    - **10 aura types**: damage, heal, slow, poison, confusion, fear, rage, shield, speed, drain\n    - Radius-based application with pulse rates\n    - Stackable effects and friendly fire control\n    - Rich visual feedback system\n\n### Behavior Control (1)\n17. **`conditional_trigger`** - Complex behavior trees\n    - **15 condition types**: hp_below, hp_above, time_elapsed, players_nearby, players_far, minions_alive, minions_dead, damage_taken, phase_time, player_count, random, position_x, position_y, distance_from_spawn, bullets_fired, ability_ready, stunned, invulnerable\n    - **Branching logic**: onTrue/onFalse action arrays\n    - **Priority system**: High priority actions can interrupt\n    - **Cooldown management**: Prevents spam triggering\n    - **Once vs continuous**: One-shot or repeating conditions\n\n### Environment Manipulation (1)\n18. **`environment_control`** - Dynamic world modification\n    - **10 environment effects**: earthquake, darkness, fog, lava_rising, ice_freeze, wind_storm, gravity_shift, time_slow, reality_warp, arena_shrink\n    - Real-time physics modification\n    - Visual and audio environment changes\n    - Persistent effect management with cleanup\n\n## Key Design Principles\n\n### 1. **Ultra-Easy Composition**\n```javascript\n// LLM can create complex behaviors by chaining simple mutators:\n{\n  \"actions\": [\n    {\"ability\": \"shield_phase\", \"args\": {\"duration\": 3}},\n    {\"ability\": \"spawn_formation\", \"args\": {\"formation\": \"star\", \"count\": 8}},\n    {\"ability\": \"pattern_shoot\", \"args\": {\"pattern\": \"spiral\", \"waves\": 3}},\n    {\"ability\": \"dynamic_movement\", \"args\": {\"pattern\": \"figure8\", \"chain\": [\n      {\"pattern\": \"spiral\", \"duration\": 2},\n      {\"pattern\": \"teleport_to_player\"}\n    ]}}\n  ]\n}\n```\n\n### 2. **Dynamic Complexity**\nThe conditional_trigger mutator enables **behavior trees**:\n```javascript\n{\n  \"ability\": \"conditional_trigger\",\n  \"args\": {\n    \"condition\": \"hp_below\",\n    \"threshold\": 0.5,\n    \"onTrue\": [\n      {\"ability\": \"environment_control\", \"args\": {\"action\": \"arena_shrink\"}},\n      {\"ability\": \"effect_aura\", \"args\": {\"auraType\": \"rage\", \"radius\": 10}}\n    ],\n    \"onFalse\": [\n      {\"ability\": \"pattern_shoot\", \"args\": {\"pattern\": \"radial\"}}\n    ]\n  }\n}\n```\n\n### 3. **Rich Parameterization**\nEvery mutator accepts detailed configuration:\n- **Timing**: duration, cooldown, pulseRate, frequency\n- **Spatial**: radius, position, offset, amplitude\n- **Behavioral**: intensity, speed, pattern, target\n- **Visual**: color, effect, visual, sound\n- **Logical**: stackable, friendly, once, loop, reverse\n\n### 4. **State Management**\nEach mutator maintains its own state object:\n- Automatic initialization on first execution\n- Persistent state across frames\n- Clean completion detection\n- Memory efficient with automatic cleanup\n\n## LLM Integration Benefits\n\n### **Emergent Complexity**\nSimple mutators combine to create behaviors that are greater than the sum of their parts:\n- A \"teleport_to_player\" + \"charge_attack\" + \"radial_burst\" creates a devastating teleport-slam combo\n- \"environment_control\" (darkness) + \"effect_aura\" (fear) + \"summon_orbitals\" creates a terrifying nightmarish phase\n\n### **Adaptive AI**\nThe conditional_trigger system allows the LLM to create **truly adaptive bosses**:\n- Different behaviors based on player count, boss health, time elapsed\n- Dynamic difficulty scaling\n- Counter-strategies based on player behavior\n\n### **Infinite Variety**\nWith 18 mutators each having 5-15 parameters, the combination space is effectively infinite, allowing the LLM to create unique encounters every time.\n\n## Files Added/Enhanced\n\n### New Mutator Files Created:\n1. `/src/mutators/spawn_formation.js`\n2. `/src/mutators/teleport_to_player.js` \n3. `/src/mutators/charge_attack.js`\n4. `/src/mutators/heal_self.js`\n5. `/src/mutators/shield_phase.js`\n6. `/src/mutators/summon_orbitals.js`\n7. `/src/mutators/pattern_shoot.js`\n8. `/src/mutators/dynamic_movement.js`\n9. `/src/mutators/conditional_trigger.js`\n10. `/src/mutators/effect_aura.js`\n11. `/src/mutators/environment_control.js`\n\n### Enhanced Files:\n- `/src/mutators/index.js` - Updated registry with all new mutators\n- `/src/Behaviors.js` - Added 9 new C# behavior ports\n\n### Documentation:\n- `/LLM_MUTATOR_SYSTEM_SUMMARY.md` - This comprehensive guide\n\nThe system now provides the LLM with **unprecedented flexibility** to create complex, dynamic, and engaging boss encounters through simple composition of powerful building blocks.